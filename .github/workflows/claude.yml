name: ü§ñ Claude Automatic Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened] # Triggers on new PR or when code is updated

jobs:
  review:
    # Set the runner and give the job the necessary permissions
    runs-on: ubuntu-latest
    permissions:
      contents: read       # Required to read the code/diff
      pull-requests: write # Required to post the review comment

    steps:
      - name: ‚¨áÔ∏è Checkout Code
        uses: actions/checkout@v4
        with:
          # Fetch depth 0 gets the full history, often required for accurate diff analysis
          fetch-depth: 0

      - name: üèÉ Run Claude Code Review
        uses: anthropics/claude-code-action@v1 # Use the latest stable version
        with:
          # The API Key is securely retrieved from the repository secrets
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          
          # The 'direct_prompt' tells Claude exactly what to do
          direct_prompt: |
            Please perform a comprehensive code review of the Pull Request changes.
            Focus on the following areas:
            1. Potential bugs or security vulnerabilities.
            2. Adherence to best practices (e.g., in CLAUDE.md if you have one).
            3. Clarity, style, and suggested optimizations.
            Provide your feedback in a single, clear, consolidated PR comment.
